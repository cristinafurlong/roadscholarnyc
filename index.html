<html>
<head>
	<title>Collision Incidents and School-related programs in Queens</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css"/>
	<link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css"/>
	<link rel="stylesheet" href="style.css"/>
	<script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script>
	<!--[if lte IE 8]>
		<link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v2/themes/css/cartodb.ie.css" />
	<![endif]-->
</head>

<body>
	<div id='map'></div>
	<ul id='legend'>
		<li class='school'>Schools</li>
		<li class='upk'>Universal Pre-K</li>
		<li class='afterschool'>After School Programs</li>
		<li class='accident'>Traffic incidents</li>
		<li class='precinct'>Precinct</li>
	</ul>
	<script>
			var map = new L.Map('map', { 
				center: [40.7371782,-73.858452],
				zoom: 12,
				minZoom: 12,
				maxZoom: 15
			});

			// add baselayer
			L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
				attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'
			}).addTo(map);

			var layers = {
				user_name:'cristina-furlong',
				type: 'cartodb',
				sublayers:[
					// precinct
					{
						sql: 'SELECT * FROM soj_nypp WHERE precinct >= 100 AND precinct <=115', // 100-115 are precincts in Queens
						cartocss: '#soj_nypp {polygon-fill: #000;polygon-opacity:0.1;line-color:#000;}'
					},
					// schools
					{
						sql: 'SELECT * FROM school_clean_geo_merge WHERE boronum = 4', // select schools in Queens
						cartocss: '#school_clean_geo_merge {marker-fill: #5770BB; marker-width:7;}',
						interactivity: 'school_name, total_enrollment'
					},
					// UPK
					{
						sql: 'SELECT * FROM soj_universal_pre_',
						cartocss: '#soj_universal_pre_ {marker-fill: #000; marker-width:7; marker-line-width:0;}',
						interactivity: 'locname, seats'
					},
					// after school
					{
						sql: 'SELECT * FROM soj_dycd_after_school_programs_csv',
						cartocss: '#soj_dycd_after_school_programs_csv {marker-fill: #ff0; marker-width:7; marker-line-width:0;}',
						interactivity: 'agency,program'
					},
					// collision
					{
						sql: 'SELECT * FROM soj_nypd_motor_vehicle_collisions_4',
						cartocss: '#soj_nypd_motor_vehicle_collisions_4 {marker-fill: #f00; marker-width:7; marker-line-width:0;}',
						interactivity: 'contributing_factor_vehicle_1, vehicle_type_code_1, date'
					},
				]
			}

			cartodb.createLayer(map,layers)
				.addTo(map)
				.on('done', function(layer){
					cdb.vis.Vis.addInfowindow(map, layer.getSubLayer(1), ['school_name','total_enrollment']);
					cdb.vis.Vis.addInfowindow(map, layer.getSubLayer(2), ['locname','seats']);
					cdb.vis.Vis.addInfowindow(map, layer.getSubLayer(3), ['agency','program']);
					cdb.vis.Vis.addInfowindow(map, layer.getSubLayer(4), ['contributing_factor_vehicle_1','vehicle_type_code_1','date']);
				});
	</script>
</body>
</html>
